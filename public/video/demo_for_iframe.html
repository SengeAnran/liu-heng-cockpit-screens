<!doctype html>
<html>
<head>
    <title>Window Demo</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Cache-Control" content="no-cache, must-revalidate" />
    <meta http-equiv="Expires" content="0" />
</head>
<style>
	html, body {
			padding: 0;
			margin: 0;
	}
	.iframe {
		margin: 100px;
		border: 1px solid blue;
	}
</style>
<body>
    <iframe id="iframe1" class="iframe" src="demo_embedded_for_iframe.html" scrolling="no" frameborder="0" width="900" height="750"></iframe>
</body>
<script src="jquery.js"></script>
<script src="jsencrypt.min.js"></script>
<script src="jsWebControl-1.0.0.min.js"></script>
<script type="text/javascript">	
	// 步骤2：嵌入子页面的页面中在iframe的onload事件中向子页面抛以下消息
	var iframeWin = document.getElementById("iframe1");
	iframeWin.onload = function(){
		iframeWin.contentWindow.postMessage({
			action:'updateInitParam',    // 告诉子页面一些初始值，包括浏览器视窗高度与宽度、iframe偏离文档的位置、iframe相对视窗的位置
			msg: '更新子页面一些初始值',
			showSize: {                       // 浏览器视窗高度与宽度
				width: $(window).width(),  
				height: $(window).height()  
			},
			iframeOffset: {                   // iframe偏离文档的位置
				left: iframeWin.offsetLeft,  
				top: iframeWin.offsetTop     
			},
			iframeClientPos: {	            // iframe相对视窗的位置
				left: iframeWin.getBoundingClientRect().left,
				right: iframeWin.getBoundingClientRect().right,
				top: iframeWin.getBoundingClientRect().top,
				bottom: iframeWin.getBoundingClientRect().bottom
			}
		});
	}
	
	// 步骤3：监听嵌入子页面的事件
	window.addEventListener('message', function(e){
		console.log(e.data);
		if(e && e.data){
			switch (e.data.action){
				case 'updatePos':
					var scrollLeftValue = document.documentElement.scrollLeft;
					var scrollTopValue = document.documentElement.scrollTop;
					console.log({ scrollLeftValue, scrollTopValue });
					iframeWin.contentWindow.postMessage({
						action:'updatePos',  
						msg: '更新Pos',
						scrollValue: {
							left: -1 * scrollLeftValue,
							top: -1 * scrollTopValue,									
						}
					});
					break;
				default:
					break;
			}
		}
	});	
</script>
</html>